language: cpp

sudo: required

os:
    - linux

dist: 
    - xenial

env:
    - BUILD_TYPE=Default EXEC=chrome SRC=src # TRAVIS_DEBUG_MODE=true

before_install:
    - cd ..
    - if [ ! -e depot_tools/gclient ]; then git clone https://chromium.googlesource.com/chromium/tools/depot_tools.git; fi
    - export PATH="$PATH:$PWD/depot_tools"
    - yes | sudo add-apt-repository ppa:git-core/ppa
    - sudo apt-get update

install:
    - git clone https://github.com/Samsung/castanets ${SRC}
    - cd ${SRC}
    - yes | sudo build/install-build-deps.sh

before_script:
    - build/create_gclient.sh
    - gclient sync --with_branch_head
    - gn gen --args='enable_castanets=true enable_nacl=false is_debug=false is_component_build=true' out/${BUILD_TYPE}

script:
    - ninja -C out/${BUILD_TYPE} -j32 mojo
    - ninja -C out/${BUILD_TYPE} -j32 services/service_manager/embedder
    - ninja -C out/${BUILD_TYPE} -j32 headless:headless_shell_lib
    - ninja -C out/${BUILD_TYPE} -j32 content/public/common:service_names
    - ninja -C out/${BUILD_TYPE} -j32 content/public/app:both
    - ninja -C out/${BUILD_TYPE} -j32 chrome/installer/util:with_no_strings
    - ninja -C out/${BUILD_TYPE} -j32 child_dependencies
    - ninja -C out/${BUILD_TYPE} -j32 browser_dependencies
    - ninja -C out/${BUILD_TYPE} -j32 chrome
    #    - travis_wait 50 ninja -C out/${BUILD_TYPE} ${EXEC}

notifications:
    email:
        recipients:
            - seikwon.kim@samsung.com
        on_success: change # <always|never|change>
        on_failure: always  # <always|never|change>

